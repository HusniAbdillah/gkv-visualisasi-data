<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Visualisasi Produksi Sayuran</title>
  <link rel="stylesheet" href="css/style.css" />
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="data/produksi_sayuran.js"></script>
</head>
<body>
  <h1>Visualisasi Produksi Sayuran di Indonesia</h1>
  
  <div class="chart-selector">
    <label for="chart-type">Pilih Jenis Diagram:</label>
    <select id="chart-type" onchange="updateChart()">
      <option value="bar">Bar Chart</option>
      <option value="line">Line Chart</option>
      <option value="pie">Pie Chart</option>
    </select>
  </div>

  <div id="chart-container">
    <div id="bar-chart" class="chart"></div>
    <div id="line-chart" class="chart" style="display: none;"></div>
    <div id="pie-chart" class="chart" style="display: none;"></div>
  </div>

  <script>
    // Validasi apakah data dari produksi_sayuran.js sudah dimuat
    if (typeof produksiData === 'undefined') {
      console.error("Data tidak tersedia. Pastikan file produksi_sayuran.js dimuat dengan benar.");
    } else {
      // Validasi sinkronisasi antara komoditas dan produksi
      produksiData.forEach(item => {
        console.assert(
          item.komoditas.length === item.produksi.length,
          `Data provinsi ${item.provinsi} tidak sinkron: ${item.komoditas.length} komoditas, ${item.produksi.length} produksi`
        );
      });

      // Fungsi untuk memperbarui chart berdasarkan pilihan pengguna
      function updateChart() {
        const chartType = document.getElementById("chart-type").value;
        document.getElementById("bar-chart").style.display = chartType === "bar" ? "block" : "none";
        document.getElementById("line-chart").style.display = chartType === "line" ? "block" : "none";
        document.getElementById("pie-chart").style.display = chartType === "pie" ? "block" : "none";
      }

      // Menyiapkan data untuk setiap diagram
      const barData = [{
        x: produksiData.map(item => item.provinsi),
        y: produksiData.map(item => item.produksi[0]), // Produksi untuk komoditas pertama
        type: 'bar'
      }];

      const lineData = [{
        x: produksiData.map(item => item.provinsi),
        y: produksiData.map(item => item.produksi[1]), // Produksi untuk komoditas kedua
        type: 'scatter',
        mode: 'lines+markers'
      }];

      const pieData = [{
        values: produksiData.map(item => item.produksi.reduce((a, b) => a + b, 0)), // Total produksi semua komoditas
        labels: produksiData.map(item => item.provinsi),
        type: 'pie'
      }];

      // Render Bar Chart
      Plotly.newPlot('bar-chart', barData);

      // Render Line Chart
      Plotly.newPlot('line-chart', lineData);

      // Render Pie Chart
      Plotly.newPlot('pie-chart', pieData);
    }
  </script>
</body>
</html>